<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ATL Alert</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:ital,wght@0,100..800;1,100..800&display=swap"
        rel="stylesheet">
    <style>
        /* :root {
        --main-color: #FFFFFF   
        --secondary-color: #000000;
        --tercery-color: #888888;
        --main-color-drk: #FFFFFF   
        --secondary-color-drk: #000000;
        --tercery-color-drk: #888888;
    } */
        html {
            contain: layout;
            scroll-behavior: smooth;
            background-color: #f0f0f0bd;
        }

        a {
            color: inherit;
            text-decoration: none !important;
        }

        a:hover {
            color: inherit;
            text-decoration: none !important;
        }

        ::-webkit-scrollbar {
            display: none;
        }

        body {
            margin: 0 auto;
            padding: 12px;
            /* background-color: #f0f0f0bd; */
            font-family: "JetBrains Mono", monospace;
            font-optical-sizing: auto;
            display: grid;
            align-items: center;
            justify-content: center;
            /* max-width: fit-content; */
        }

        .grid-container {
            /* max-width: viewport-width; */
            max-width: 750px;
            display: grid;
            grid-template-columns: repeat(autofill,
                    minmax(90px, 1fr));
            gap: 10px;
            /* gap: 9.5px; */
            /* padding-top: 18px; */
            padding-top: 20px;
        }

        i img {
            display: block !important;
            margin: 0px auto !important;
            max-width: 75%;
            height: auto;
            text-align: center;
            border-radius: 12px;
            padding: 10px;
        }

        .address {
            -webkit-user-select: none;
            user-select: none;
            text-decoration: none;
            cursor: pointer;
            color: background-rgb(253, 253, 253);
        }

        h1 a {
            color: inherit;
            text-decoration: none;
            margin: 0;           
        }

        h1 {
            font-size: 14.875px;
            font-weight: 700;
            line-height: normal;
            word-spacing: -1.875px;
            margin: 0;
            padding-bottom: 8px;
            padding-top: 4px;
            color: #4429be;
            /* border-bottom: 0.975px dotted #4429beaf; */
            /* background: repeating-linear-gradient(90deg, transparent 0, transparent 1.975px, currentColor 4px, currentColor 5px) bottom / 3.975px 0.975px repeat-x; */
            background: repeating-linear-gradient(90deg, transparent 0, transparent 8px, #4429be4b 8px, #4429be4b 9px) bottom / 9px 2px repeat-x;
        }

        p {
            /* display: -webkit-box;
            -webkit-box-orient: vertical; */
            /* overflow-wrap: break-word; */
            /* overflow: hidden;
            text-overflow: ellipsis; */
            white-space: pre-wrap;
            padding-top: 11px;
            font-size: 13.5px;
            line-height: 1.75;
            letter-spacing: 0.35px;
            word-spacing: -.015px;
            margin: 0;
            /* overflow: hidden; */
            color: #4429be;
            text-indent: 25px;
        }

        .preview {
            display: -webkit-box;
            -webkit-box-orient: vertical;
            /* -webkit-line-clamp: 4;
            line-clamp: 4; */
            /* overflow: hidden;
            text-overflow: ellipsis; */
        }

        .preview.expanded {
            display: -webkit-box;
            -webkit-box-orient: vertical;
            /* -webkit-line-clamp: 4;
            line-clamp: 4;
            overflow: hidden;
            text-overflow: ellipsis; */
        }

        .post {
            position: relative;
            cursor: pointer;
            min-width: 0;
            padding: 12px;
            background-color: rgb(253, 253, 253);
            border-radius: 16px;
            /* border: 0.875px solid #4429be; */
            height: 120px;
            border: 1.991px solid #4429be;
            /* white-space: pre-wrap;
            overflow-wrap: break-word; */
            text-overflow: ellipsis;
            overflow: hidden;
            text-align: left;
            line-height: 1;
            transition: 700ms cubic-bezier(0.25, 0.8, 0.25, 1);
        }

        .gradient {
            display: block;
            position: absolute;
            inset: 0;
            overflow: hidden;
            background-image: linear-gradient(to bottom, rgba(253, 253, 253, 0.05) 50%, rgba(253, 253, 253, 0.7) 75%, rgba(253, 253, 253, 1.0) 95%);
            /* filter: blur(0.875px); */
            /* background-blend-mode: darker; */
            pointer-events: none;
            /* z-index: 10; */
        }

        .post:active {
            background-color: rgb(195, 214, 243);
        }

        .post.fade-out {
            background-color: rgb(195, 214, 243);
        }

        .drawer {
            box-shadow: 2px 2px 8px rgba(0, 0, 0, 0.06);
            cursor: pointer;
            position: fixed;
            contain: none;
            top: 0;
            left: 0;
            right: 0;
            margin: 0 auto;
            width: 100%;
            max-width: 750px;
            height: 200px;
            background-color: rgb(250, 250, 250);
            z-index: 1000;
            transform: translateY(-90%);
            /* Mostly hidden on app open */
            transition: transform 200ms ease;
            border-radius: 0 0 16px 16px;
        }

        .drawer::after {
            content: '';
            position: absolute;
            bottom: 6px;
            left: 50%;
            transform: translateX(-50%);
            width: 30px;
            height: 4px;
            background-color: #dbdbdb;
            border-radius: 2px;
        }

        .drawer.open {
            transform: translateY(0);
        }

        .search-input-wrapper {
            position: fixed;
        }

        .search-input {
            position: fixed;
            font-family: "JetBrains Mono", monospace;
            font-optical-sizing: auto;
            display: grid;
            font-size: 13.5px;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            /* width: calc(50% - 6px); */
            width: 50%;
            background: inherit;
            border-radius: 12px;
            /* border: 0.875px solid #4429be; */
            border: 1.991px solid #4429be;
            padding: 4px;
            z-index: 1001;
            box-shadow: inset -2px 2px 8px rgba(0, 0, 0, 0.05);    
            text-indent: 4px;        
        }

        .search-input:focus,
        .search-input:active {
            outline: none;
            /* border: 0.875px solid #8369f7 !important; */
            border: 1.991px solid #8369f7 !important;
        }        

        /* This wil only show on Webkit & Chrome, need custom solution for compatibility 
        .search-input::-webkit-search-cancel-button {
            -webkit-appearance: relative;
            background-color: #4429be;
            width: 10px;
            height: 10px;
        } */

        .search-wrapper {
            top: 50%;
            float: right;
            padding-right: 2px;
        }

    </style>
</head>

<body>
    <!-- <div class="grid-container">
        <div tabindex="1" class="post">
            <h1>Sed ut Perspiciatis</h1>
            <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor.</p>
    </div>  -->
    <script>

        document.addEventListener('DOMContentLoaded', (event) => {

        const container = document.createElement('div');
        container.classList.add('grid-container');
        document.body.appendChild(container);

        // Add main event listeners here,
        // then figure out how to have them figure out
        // which div is clicked on click, etc?
        // Will this stop the janky animation on JoyTab?

        // Fetch JSON & populate cards
        fetch('titles.json')
            .then(res => res.json())
            .then(title => {
                title.forEach(item => {
                    let titleText = String(item.titles);
                    let bodyText = String(item.bodies);
                    // bodyText = bodyText.replace(/\n/g, '<br>'), 
                    bodyText = bodyText
                        // .replace(/<div[^>]*>\s*<\/div>/gi, '')
                        .replace(/<div[^>]*data-olk-copy-source=["']MessageBody["'][^>]*>([\s\S]*?)<\/div>/gi, '$1')
                        .replace(/<div[^>]*>/gi, '<p>')
                        .replace(/<\/div>/gi, '</p>')
                        .replace(/<p[^>]*>(\s|&nbsp;)*<\/p>/gi, '')
                        .replace(/<div>*>(\s|&nbsp;)*<\/div>/gi, '')
                        .trim();

                    let card = document.createElement('div');
                    card.classList.add('post');
                    card.innerHTML = `<span class="preview"><h1>${titleText}</h1><p>${bodyText}</p></span>`;
                    card.innerHTML = card.innerHTML
                        .replace(/<p[^>]*>(\s|&nbsp;)*<\/p>/gi, '')
                        .trim()
                        .replace(
                            /(src=["'])(\/home\/showpublishedimage\/[^"']*)/gi,
                            '$1https://www.atlantapd.org$2'
                        );
                    // Remove indent if text doesn't overflow
                    let p = card.querySelector('p');
                    if  (p.scrollHeight <= p.offsetHeight)  {
                        p.style.textIndent = '0px';
                        };
                    container.appendChild(card);
                    console.log(bodyText);
                    // return card;
                });

                // Drawer menu & child elements
                let drawer = document.createElement('div');
                drawer.classList.add('drawer');
                document.body.appendChild(drawer);
              
                drawer.addEventListener('click', (event) => {
                    // If search-input clicked, do not toggle drawer
                    if (event.target === search) return;
                    else {
                    drawer.classList.toggle('open')
                    }
                });

                // Add wrapper for search-input & include 'X' icon
                let search = document.createElement('input');
                search.type = 'search';
                search.placeholder = 'Search...';
                search.classList.add('search-input');
                drawer.appendChild(search);
               
                // Search logic
                const searchInput = document.querySelector('.search-input');
                const posts = document.querySelectorAll('.post');

                searchInput.addEventListener('input', (event) => {
                const query = event.target.value.toLowerCase().trim();
                posts.forEach(post => {
                    const text = post.textContent.toLowerCase();

                    if (text.includes(query)) {
                        post.style.display = '';
                    } else { 
                        post.style.display = 'none';
                    }
                });
                });
                
                searchInput.addEventListener('keydown', (event) => {
                    if (event.key === 'Enter' || 
                        event.key === 'Escape') {
                        drawer.classList.remove('open');
                        searchInput.blur();
                    }
                });
                            
                // Cards expand on click & gradient add/removal
                const expand = document.querySelectorAll('.post');  
                
                expand.forEach(post => {
                    const gradient = document.createElement('div');
                    gradient.classList.add('gradient');
                    post.appendChild(gradient);
                    post.addEventListener('click', function () {
                        this.style.height = this.style.height === 'auto' ? '120px' : 'auto';
                        expand.forEach(post => { if (post !== this) post.style.height = '120px' }); 
                        gradient.style.display = gradient.style.display === 'none' ? 'block' : 'none';
                        
                        // This work? How to set all to 'block' except clicked one, at all times?
                        // if (post !== 'clicked') {
                        //     gradient.style.display = 'block';
                        // } else if (post === 'clicked') {
                        //     gradient.style.display = 'none';
                        // };
                });
                        
                        console.log('clicked' + this);
                    });

                // BG change on mouseup / touchend
                const clickColorDown = document.querySelectorAll('.post');
                clickColorDown.forEach(post => {
                    post.addEventListener('mouseup', function () {
                        post.classList.add('fade-out');
                        setTimeout(() => {
                            post.classList.remove('fade-out');
                        }, 300);
                    });
                    post.addEventListener('touchend', function () {
                        post.classList.add('fade-out');
                        setTimeout(() => {
                            post.classList.remove('fade-out');
                        }, 300);
                    });
                });

            });
        });
    </script>
</body>
</html>